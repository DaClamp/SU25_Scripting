import sys
import pygame
import random
import time

# --- Initialization ---
pygame.init()
width, height = 600, 400
screen = pygame.display.set_mode((width, height))
pygame.display.set_caption("Don't Let the Chicken Drop")

# --- Load images ---
chicken = pygame.image.load("chicken.png").convert_alpha()
powerup = pygame.image.load("chicken.png").copy()  # use chicken sprite for powerup and tint it
# Tint the powerup to make it visually different
powerup.fill((100, 255, 100, 128), special_flags=pygame.BLEND_RGBA_MULT)

# Game variables
numOfThings = 7
chickenImage = []
chickenX = []
chickenY = []
chickenSpeed = []
baseSpeed = 10
speedMulti = 1.2
gameOver = False
scene = 0

# Power-up variables
powerup_x = random.randint(0, width - chicken.get_width())
powerup_y = random.randint(100, height - 100)
powerup_timer = 0
slowdown_active = False
slowdown_start = 0
next_powerup_time = pygame.time.get_ticks() + 15000  # 15 seconds from start

# Colors and fonts
green = (74, 93, 35)
orange = (243, 121, 78)
black = (0, 0, 0)
font = pygame.font.SysFont("Arial", 30)

# Create chickens
for _ in range(numOfThings):
    chickenImage.append(chicken)
    chickenX.append(random.randint(0, width - chicken.get_width()))
    chickenY.append(random.randint(-chicken.get_height() * 2, 0))
    chickenSpeed.append((baseSpeed + random.random()) / 100)

# Main loop
while not gameOver:
    screen.fill((135, 206, 235))  # sky blue

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            gameOver = True

    # Handle mouse clicks
    if pygame.mouse.get_pressed()[0]:
        mx, my = pygame.mouse.get_pos()
        for i in range(numOfThings):
            if chickenX[i] <= mx <= chickenX[i] + chicken.get_width() and chickenY[i] <= my <= chickenY[i] + chicken.get_height():
                chickenX[i] = random.randint(0, width - chicken.get_width())
                chickenY[i] = random.randint(-chicken.get_height() * 2, 0)
                chickenSpeed[i] *= speedMulti

        # Check powerup click
        if powerup_x <= mx <= powerup_x + powerup.get_width() and powerup_y <= my <= powerup_y + powerup.get_height():
            slowdown_active = True
            slowdown_start = pygame.time.get_ticks()
            next_powerup_time = pygame.time.get_ticks() + 15000
            powerup_x = -100  # move it off screen temporarily

    # Update chickens
    for i in range(numOfThings):
        if chickenY[i] + chicken.get_height() > height:
            gameOver = True
        else:
            speed = chickenSpeed[i]
            if slowdown_active:
                speed *= 0.2
            chickenY[i] += speed
        screen.blit(chickenImage[i], (chickenX[i], chickenY[i]))

    # Handle powerup timer
    now = pygame.time.get_ticks()
    if slowdown_active and now - slowdown_start > 10000:
        slowdown_active = False

    if now >= next_powerup_time and not slowdown_active:
        powerup_x = random.randint(0, width - powerup.get_width())
        powerup_y = random.randint(100, height - 100)
        next_powerup_time = now + 15000  # reset timer

    # Draw powerup
    if not slowdown_active and now >= next_powerup_time - 15000 + 1000:  # spawn 1s after reset
        screen.blit(powerup, (powerup_x, powerup_y))
        screen.blit(font.render("Click the green chicken to slow time", True, black), (10, 10))

    pygame.display.flip()
    pygame.time.delay(10)

pygame.quit()
